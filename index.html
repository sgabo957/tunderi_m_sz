<!doctype html>
<html lang="hu">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tündéri Masszázs Szalon — Online Időpontfoglalás</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Tündéri Arculat Alapja */
        :root{
            --bg: #f8f0e5; /* Pasztell krém/bézs */
            --card: #ffffff;
            --accent-main: #9c6644; /* Barna-arany / Fa színe */
            --accent-light: #d4a373; /* Világosbarna / Mézszín */
            --muted: #666;
            --font-main: 'Playfair Display', serif;
            --font-title: 'Great Vibes', cursive;
        }
        * { box-sizing: border-box; }
        body { font-family: var(--font-main); margin: 0; background-color: var(--bg); color: #222; }
        
        /* Címek és kiemelések */
        h1, h2 { font-family: var(--font-title); color: var(--accent-main); text-align: center; margin: 0; }
        h1 { font-size: 2.2rem; }
        h2 { font-size: 1.8rem; margin-bottom: 20px; }
        
        /* Fejléc */
        header { background: var(--accent-light); padding: 10px 16px; display: flex; align-items: center; justify-content: space-between; gap: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .brand { display: flex; align-items: center; gap: 12px; }
        .logo-img { height: 60px; border-radius: 8px; } /* Logó méretének igazítása */
        .sub { color: #f8f0e5; font-size: .9rem; } /* Fejléc alatti szöveg színe */
        .contact a { color: #f8f0e5; text-decoration: none; }
        
        main { max-width: 1100px; margin: 28px auto; padding: 0 16px; }

        /* Fő tartalom elrendezése */
        .grid { display: grid; grid-template-columns: 1fr 380px; gap: 24px; }
        @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

        .card { background: var(--card); border-radius: 14px; padding: 24px; box-shadow: 0 6px 18px rgba(17, 12, 39, 0.08); }
        
        /* ŰRLAP ELEMEK ÚJ ELRENDEZÉSE: MINDEN EGYMÁS ALATT */
        form > div:not(.times) { 
            margin-bottom: 15px; 
        }
        form .full-width-input { 
            display: block; 
            width: 100%; 
        }

        label { display: block; font-size: .95rem; margin-bottom: 6px; color: var(--accent-main); font-weight: 700; }
        input[type=text], input[type=email], input[type=tel], select, textarea, input[type=date] {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--accent-light); background: #fff;
            font-family: var(--font-main); font-size: 1rem;
        }
        textarea { min-height: 80px; resize: vertical; }

        /* Időpont slotok (megtartjuk a grid elrendezést a szlotoknál) */
        .times { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        @media (max-width: 500px) { .times { grid-template-columns: repeat(2, 1fr); } }

        .slot {
            padding: 8px; border-radius: 8px; border: 1px solid var(--accent-light);
            text-align: center; cursor: pointer; background: #fff; color: var(--accent-main);
            transition: all 0.2s; font-family: var(--font-main);
        }
        .slot:hover:not(.taken) { background: #fdf5e7; }
        .slot.taken { opacity: .5; cursor: not-allowed; border-color: #eee; color: #999; }
        .slot.selected { background: var(--accent-main); color: #fff; border-color: var(--accent-main); }
        
        /* Gomb */
        .btn { display: block; width: 100%; padding: 12px 14px; border-radius: 10px; border: 0; background: var(--accent-main); color: #fff; font-weight: 700; cursor: pointer; font-size: 1rem; transition: background 0.3s; }
        .btn:hover { background: #7a4f33; }
        .muted { color: var(--muted); font-size: .9rem; }
        .small { font-size: .85rem; }

        /* Összegzés (Aside) */
        aside .summary-title { font-weight: 700; margin-bottom: 12px; font-size: 1.1rem; color: var(--accent-main); }
        .summary { display: flex; flex-direction: column; gap: 10px; text-align: left; }
        .summary hr { border: none; border-top: 1px dashed #eee; margin: 10px 0; }
        
        /* Figyelmeztető üzenet (speciális esetekhez) */
        .alert-message { padding: 15px; background: #ffebeb; color: #cc0000; border-radius: 8px; margin-top: 15px; font-weight: 700; }
        
        /* Footer */
        footer { max-width: 980px; margin: 28px auto 10px auto; padding: 16px; text-align: center; color: var(--muted); border-top: 1px solid #eee; }

    </style>
</head>
<body>
    <header>
        <div class="brand">
            <img src="logo.jpg" alt="Tündéri Masszázs Logó" class="logo-img">
            <div>
                <h1>Tündéri masszázs szalon</h1>
                <div class="sub">Wellness, gyógyítás és tiszta kényeztetés</div>
            </div>
        </div>
        <div class="contact small">
            <div>Telefon: <a href="tel:+36204216958">+36 (20) 421 6958</a></div>
        </div>
    </header>

    <main>
        <div class="grid">
            <section class="card">
                <h2>Foglalj időpontot</h2>
                <p class="muted">Kérjük, válassza ki a szolgáltatást, napot és időpontot. Foglalási naptárunk **Hétfőtől Péntekig** fogad időpontot. Két kezelés között **30 perc szünet** biztosítja a takarítást/átállást.</p>

                <form id="booking-form" autocomplete="off">
                    <div>
                        <label for="name">Név *</label>
                        <input type="text" id="name" required placeholder="Pl. Kovács István" class="full-width-input">
                    </div>

                    <div>
                        <label for="phone">Telefon *</label>
                        <input type="tel" id="phone" required placeholder="+36 20 ..." class="full-width-input">
                    </div>

                    <div>
                        <label for="email">Email (opcionális)</label>
                        <input type="email" id="email" placeholder="valaki@pelda.hu" class="full-width-input">
                    </div>

                    <div>
                        <label for="service">Masszázsok *</label>
                        <select id="service" class="full-width-input">
                            <option value="test60">Teljes test masszázs (60 perc)</option>
                            <option value="hat30">Hátmasszázs (30 perc)</option>
                            <option value="talp25">Talpmasszázs (25 perc)</option>
                            <option value="reflex1">Reflexzónás talpmasszázs (1. alkalom - 60 perc)</option>
                            <option value="reflex2">Reflexzónás talpmasszázs (2. alkalomtól - 45 perc)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="other-service">Egyéb szolgáltatások (opcionális)</label>
                        <select id="other-service" class="full-width-input">
                            <option value="">— Nincs egyéb szolgáltatás —</option>
                            <option value="kop">Köpölyözés (kb 20 perc)</option>
                            <option value="kinesio">Kinesio tape ragasztás</option>
                            <option value="reiki">Reiki kezelés</option>
                            <option value="csakra">Csakratisztítás, harmonizálás</option>
                        </select>
                    </div>


                    <div>
                        <label for="date">Dátum *</label>
                        <input type="date" id="date" required class="full-width-input">
                        <div id="date-message" class="muted small" style="margin-top:5px; color:#cc0000"></div>
                    </div>

                    <div>
                        <label>Időpont (kattints egy szabad helyre) *</label>
                        <div id="times" class="times" aria-live="polite">
                            <div class="muted small" style="grid-column: 1 / -1; text-align: center;">Válassz dátumot a szabad időpontok megtekintéséhez.</div>
                        </div>
                    </div>

                    <div>
                        <label for="note">Megjegyzés</label>
                        <textarea id="note" placeholder="Pl. külön kérés, egészségügyi megjegyzés..." class="full-width-input"></textarea>
                    </div>

                    <div style="margin-top:20px;display:flex;flex-direction:column;gap:10px;align-items:center">
                        <button type="submit" class="btn">Foglalás megerősítése</button>
                        <div class="muted small">A foglalás demó céllal a böngésződben (localStorage) tárolódik.</div>
                    </div>
                </form>
            </section>

            <aside class="card">
                <div class="summary-title">Összefoglaló</div>
                <div class="summary">
                    <div><strong>Név:</strong> <span id="s-name">—</span></div>
                    <div><strong>Telefon:</strong> <span id="s-phone">—</span></div>
                    <div><strong>Masszázs:</strong> <span id="s-service">Teljes test masszázs (60 perc)</span></div>
                    <div><strong>Egyéb:</strong> <span id="s-other-service">—</span></div>
                    <div><strong>Dátum:</strong> <span id="s-date">—</span></div>
                    <div><strong>Időpont:</strong> <span id="s-time">—</span></div>
                    <hr>
                    <div class="muted small">A rendszerben foglalt időpontok automatikusan foglaltnak minősülnek, így garantáltan elkerülhető a dupla foglalás.</div>
                </div>
            </aside>
        </div>
        
        <section style="margin-top: 40px; text-align: center;">
            <h2>Árak és Szolgáltatások</h2>
            <img src="arlista.jpg" alt="Masszázs árlista" style="max-width: 100%; height: auto; border: 3px solid var(--accent-light); border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); display: block; margin: 20px auto;">
        </section>
        
        <section style="margin-top: 40px; text-align: center;">
            <h2>Elérhetőség</h2>
            <img src="nevjegy_kartya.jpg" alt="Névjegykártya adatok" style="max-width: 300px; height: auto; border-radius: 8px; display: block; margin: 20px auto;">
        </section>
    </main>

    <footer>
        <div>© 2025 Tündéri Masszázs Szalon • Nyitvatartás: Hétfő–Péntek (előzetes bejelentkezéssel)</div>
    </footer>

    <script>
        const timesEl = document.getElementById('times');
        const dateEl = document.getElementById('date');
        const form = document.getElementById('booking-form');
        const dateMessageEl = document.getElementById('date-message');
        const phoneEl = document.getElementById('phone');
        const otherServiceEl = document.getElementById('other-service');

        const summary = {
            name: document.getElementById('s-name'),
            phone: document.getElementById('s-phone'),
            service: document.getElementById('s-service'),
            otherService: document.getElementById('s-other-service'), 
            date: document.getElementById('s-date'),
            time: document.getElementById('s-time'),
            note: document.getElementById('s-note')
        };

        // SZOLGÁLTATÁSOK IDŐTARTAMA
        const serviceDurations = {
            test60: 60, 
            hat30: 30, 
            talp25: 25, 
            reflex1: 60, 
            reflex2: 45 
        };
        const CLEANUP_BUFFER_MINUTES = 30; // 30 perc szünet

        const OPEN_TIME = "10:00";
        const CLOSE_TIME = "18:00";
        
        // ADMIN ÁLTAL BLOKKOLT NAPOK
        const BLOCKED_DATES = [
            "2025-10-23", 
            "2025-12-24", 
            "2025-12-25",
            "2025-12-26"
        ];
        

        function getBookings(){
            try{ return JSON.parse(localStorage.getItem('tunderi_bookings')||'[]'); }catch(e){ return [] }
        }
        function saveBookings(b){ localStorage.setItem('tunderi_bookings', JSON.stringify(b)); }

        function toMinutes(hhmm){
            const [h,m] = hhmm.split(":").map(Number);
            return h * 60 + m;
        }
        function toHHMM(mins){
            const h = Math.floor(mins / 60);
            const m = mins % 60;
            return String(h).padStart(2,"0") + ":" + String(m).padStart(2,"0");
        }

        function isDateBlocked(dateString, dayOfWeek){
            if(dayOfWeek === 0 || dayOfWeek === 6){
                return 'weekend';
            }
            if(BLOCKED_DATES.includes(dateString)){
                return 'holiday';
            }
            return null;
        }

        function renderTimes(){
            timesEl.innerHTML = '';
            dateMessageEl.textContent = ''; 
            
            const dateStr = dateEl.value;
            if(!dateStr){ 
                timesEl.innerHTML = '<div class="muted small" style="grid-column: 1 / -1; text-align: center;">Kérjük, válassz dátumot.</div>'; 
                return;
            }
            
            const selectedDate = new Date(dateStr + 'T00:00:00'); 
            const dayOfWeek = selectedDate.getDay(); 

            const blockReason = isDateBlocked(dateStr, dayOfWeek);
            
            if(blockReason){
                timesEl.innerHTML = '';
                
                if (blockReason === 'weekend') {
                    const dayName = dayOfWeek === 0 ? 'vasárnap' : 'szombat';
                    timesEl.innerHTML = `<div class="alert-message" style="grid-column: 1 / -1; background: #fff0d9; color: var(--accent-main); font-weight: 400;">A ${dateStr} egy ${dayName}. A szalon hétvégén zárva tart. Kérlek, válassz egy hétköznapot.</div>`;
                } else if (blockReason === 'holiday') {
                    dateMessageEl.textContent = 'Ez a nap (ünnepnap/szabadság) le van zárva. Kérlek, válassz másik napot.';
                }
                return;
            }

            const service = document.getElementById('service').value;
            const duration = serviceDurations[service] || 60; 

            const bookings = getBookings().filter(b => b.date === dateStr);

            let current = toMinutes(OPEN_TIME);
            const endOfDay = toMinutes(CLOSE_TIME);

            let hasSlots = false;
            
            while(current + duration <= endOfDay){
                const slotStart = current;
                const slotEnd = current + duration;
                const label = toHHMM(slotStart);

                const taken = bookings.some(b => {
                    const bStart = toMinutes(b.time);
                    const bDuration = serviceDurations[b.service] || 60;
                    const bEnd = bStart + bDuration + CLEANUP_BUFFER_MINUTES; 
                    
                    return !(slotEnd <= bStart || slotStart >= bEnd);
                });

                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'slot' + (taken ? ' taken' : '');
                btn.textContent = label;
                if(!taken){ 
                    hasSlots = true;
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.slot').forEach(s => s.classList.remove('selected'));
                        btn.classList.add('selected');
                        updateSummary('time', label);
                    });
                }
                timesEl.appendChild(btn);

                current = slotEnd + CLEANUP_BUFFER_MINUTES; 
            }
            
            if(!hasSlots){
                 timesEl.innerHTML = '<div class="alert-message" style="grid-column: 1 / -1;">Sajnáljuk, ezen a napon már nincsen szabad időpont, vagy a szolgáltatás túl hosszú!</div>'; 
            }
        }

        function updateSummary(field, value){
            switch(field){
                case 'name': summary.name.textContent = value || '—'; break;
                case 'phone': summary.phone.textContent = value || '—'; break;
                case 'service': summary.service.textContent = document.getElementById('service').selectedOptions[0].text; break;
                case 'otherService': summary.otherService.textContent = document.getElementById('other-service').selectedOptions[0].text.replace('— Nincs egyéb szolgáltatás —', '—'); break;
                case 'date': summary.date.textContent = value || '—'; break;
                case 'time': summary.time.textContent = value || '—'; break;
            }
        }
        
        function filterPhoneNumber(event) {
            let input = event.target.value;
            let filtered = '';
            
            if (input.startsWith('+')) {
                filtered = '+';
                input = input.substring(1);
            }
            
            filtered += input.replace(/[^0-9]/g, '');

            event.target.value = filtered;
        }

        // Eseménykezelők
        document.getElementById('name').addEventListener('input', e => updateSummary('name', e.target.value));
        phoneEl.addEventListener('input', e => {
            filterPhoneNumber(e);
            updateSummary('phone', e.target.value);
        });
        document.getElementById('service').addEventListener('change', () => {
            updateSummary('service'); 
            updateSummary('time', '—');
            renderTimes();
        });
        otherServiceEl.addEventListener('change', () => {
            updateSummary('otherService'); 
        });
        document.getElementById('note').addEventListener('input', e => { /* Megjegyzés kezelése */ });

        dateEl.addEventListener('change', e => { 
            updateSummary('date', e.target.value); 
            updateSummary('time', '—');
            renderTimes(); 
        });

        form.addEventListener('submit', e => {
            e.preventDefault();
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const service = document.getElementById('service').value;
            const otherService = document.getElementById('other-service').value;
            const date = document.getElementById('date').value;
            const selected = document.querySelector('.slot.selected');
            const note = document.getElementById('note').value.trim();

            if(!name || !phone || !date || !selected){
                alert('Kérlek add meg a nevet, telefont, dátumot és válassz egy időpontot.');
                return;
            }
            if (!/^\+?[0-9]+$/.test(phone)) {
                alert('A telefonszám formátuma nem megfelelő. Csak számokat és opcionálisan a "+" jelet engedélyezzük.');
                return;
            }
            
            const blockReason = isDateBlocked(date, new Date(date + 'T00:00:00').getDay());
            if (blockReason) {
                alert('Hiba: Ez a nap már nem foglalható. Kérlek, válassz másik napot.');
                renderTimes();
                return;
            }

            const time = selected.textContent;

            const bookings = getBookings();
            const isStillAvailable = !bookings.some(b => b.date === date && b.time === time);
            
            if(!isStillAvailable){
                 alert('Hiba: Ezt az időpontot közben lefoglalták. Kérlek, válassz másik időpontot.');
                 renderTimes();
                 return;
            }

            const newBooking = { 
                id: Date.now(), 
                name, 
                phone, 
                email, 
                service, 
                otherService, 
                date, 
                time, 
                note 
            };
            bookings.push(newBooking);
            saveBookings(bookings);

            alert(`Sikeres foglalás! ${name}, a ${date} ${time} időpont lefoglalva. Egyéb szolgáltatás: ${otherServiceEl.selectedOptions[0].text.replace('— Nincs egyéb szolgáltatás —', 'nincs megadva')}.`);

            // Űrlap nullázása és összefoglaló frissítése
            form.reset();
            document.querySelectorAll('.slot').forEach(s => s.classList.remove('selected'));
            updateSummary('name',''); 
            updateSummary('phone',''); 
            updateSummary('service'); 
            updateSummary('otherService'); 
            updateSummary('date',''); 
            updateSummary('time','');
            renderTimes();
        });

        (function init(){
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2,'0');
            const dd = String(today.getDate()).padStart(2,'0');
            dateEl.min = `${yyyy}-${mm}-${dd}`;
            
            updateSummary('service');
            updateSummary('otherService');
            renderTimes();
        })();
    </script>
</body>
</html>